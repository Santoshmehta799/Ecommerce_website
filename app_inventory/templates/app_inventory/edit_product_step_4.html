{% extends 'seventh-square/layout/base.html' %}
{% load static %}
{% block title %}Seller Profile | Seventh Square Seller{% endblock title %}
{% block metablock %}{% endblock metablock %}
{% block cssblock %}
    <link rel="stylesheet" href="{% static 'seventh-square/assets/css/bs-stepper/bs-stepper.min.css' %}" />
    <style>
        .custom-model-min-width{
            min-width: 44.5%;
        }

        .active .bs-stepper-circle {
            background-color: #4C5864;
        }
    </style>
{% endblock cssblock %}
{% block content %}
	<div class="container-fluid">
		<div class="row">
			<!-- Messages Start --> 
				{% include 'seventh-square/layout/messages.html' %}
				{% if error %}
					<div class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
						{{ error|safe }}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				{% endif %}
			<!-- Messages END -->
			<div class="col-12 col-md-12 bg-white">
				<div class="row pl-0">
					<!-- Col-3 is written as sidebar -->
					<div class="custom-sidebar-col-width bg-brand-sidebar d-none d-md-block text-white">
						<div class="row pt-4 px-4">
							<div class="col-12"> {%include 'seventh-square/layout/sidebar.html' %} </div>
						</div>
					</div>
					<div class="custom-main-col-width">
						<div class="row px-4 pt-3">
							<div class="col-md-12">
								<nav aria-label="breadcrumb">
									<ol class="breadcrumb">
										<li class="breadcrumb-item"><a class="text-dark text-decoration-none" href="/">Home</a></li>
										<li class="breadcrumb-item active" aria-current="page">Edit New Product</li>
									</ol>
								</nav>
							</div>
						</div>
						<div class="row px-4">
							<div class="col-md-12 px-3">
								<h2 class="text-center text-black">Edit New Product</h2>
							</div>
						</div>
						<div class="row mx-2 mb-4">
							<div class="col-12">
                                <div class="card mb-3" id="all_fields_card">
                                    <div class="card-header py-3 text-left bg-brand">
                                        <h3 class="m-0 text-black">Product Details</h3>
                                    </div>
                                    <div class="card-body m-1 p-1">
                                        <div class="mb-5 bg-white shadow-sm">

                                            <div id="stepperForm" class="bs-stepper">
                                                <div class="bs-stepper-header" role="tablist">
                                                    <div class="step" data-target="#stepper-form-1">
                                                        <button type="button" class="step-trigger" role="tab" id="stepperFormTrigger1" aria-controls="stepper-form-1">
                                                            <span class="bs-stepper-circle">1</span>
                                                            <span class="bs-stepper-label">Basic Info</span>
                                                        </button>
                                                    </div>
                                                    <div class="bs-stepper-line"></div>
                                                    <div class="step" data-bs-skip data-target="#stepper-form-2">
                                                        <button type="button" class="step-trigger" role="tab" id="stepperFormTrigger2" aria-controls="#stepper-form-2">
                                                            <span class="bs-stepper-circle">2</span>
                                                            <span class="bs-stepper-label">Variants</span>
                                                        </button>
                                                    </div>
                                                    <div class="bs-stepper-line"></div>
                                                    <div class="step" data-target="#stepper-form-3">
                                                        <button type="button" class="step-trigger" role="tab" id="stepperFormTrigger3" aria-controls="#stepper-form-3">
                                                            <span class="bs-stepper-circle">3</span>
                                                            <span class="bs-stepper-label">More Info</span>
                                                        </button>
                                                    </div>
                                                    <div class="bs-stepper-line"></div>
                                                    <div class="step active" data-target="#stepper-form-4">
                                                        <button type="button" class="step-trigger" role="tab" id="stepperFormTrigger4" aria-controls="#stepper-form-4">
                                                            <span class="bs-stepper-circle">4</span>
                                                            <span class="bs-stepper-label"> Pricing</span>
                                                        </button>
                                                    </div>
                                                    <div class="bs-stepper-line"></div>
                                                    <div class="step" data-target="#stepper-form-5">
                                                        <button type="button" class="step-trigger" role="tab" id="stepperFormTrigger5" aria-controls="#stepper-form-5">
                                                            <span class="bs-stepper-circle">5</span>
                                                            <span class="bs-stepper-label">Shipping</span>
                                                        </button>
                                                    </div>
                                                </div>

                                                <div class="bs-stepper-content">
                                                    <div id="stepper-form-1"  role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="stepperFormTrigger1">
                                                        
                                                    </div>

                                                    <div id="stepper-form-2"  role="tabpanel" class="bs-stepper-pane fade " aria-labelledby="stepperFormTrigger2">
                                                        
                                                    </div>

                                                    <div id="stepper-form-4"  role="tabpanel" class="bs-stepper-pane fade active" aria-labelledby="stepperFormTrigger4">
                                                        {% if product_obj.product_variant %}
                                                            <form class="needs-validation"  method="POST" id="basic-info-form" novalidate="" enctype="multipart/form-data">
                                                                {% csrf_token %}
                                                                
                                                                <div class="form-row">
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label w-100" for="id_hsn_code">HSN Code</label>
                                                                        <input class="form-control d-inline-block w-75" type="number" required onkeyup="validateHSN(this)" id="id_hsn_code" style="width:390px!important;" value="{% if product_obj.product_has_variant == True %}{% if product_obj.product_variant.all %}{% for obj in product_obj.product_variant.all %}{% if obj.default_variant == True %}{% if obj.product_variant_price_structure %}{{obj.product_variant_price_structure.hsn_code}}{% endif %}{% endif %}{% endfor %}{% endif %}{% endif %}" name="hsn_code">

                                                                        <span class="d-inline-block" style="margin-top: 1px; font-size: 12px !important;display:block;">
                                                                            <a href="https://services.gst.gov.in/services/searchhsnsac" style="color: black" target="_blank">Find Relevant HSN Code</a>
                                                                        </span>
                                                                    
                                                                    </div>
                                                                    {% if not product_obj.product_has_variant %}
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label" for="id_price_on_request">Price on Request</label>
                                                                        <select class="form-control" id="id_price_on_request" onchange="checkPOQ()" name="price_on_request" aria-placeholder="Price on Quotation">
                                                                            <option selected="true" disabled="disabled" value=""></option>
                                                                            <option value="False">No</option>
                                                                            <option value="True">Yes</option>
                
                                                                            <input type="text" id="showRecieve3" name="showRecieve3" style="border:none;background-color:white;" hidden>
                                                                            
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label" for="id_mrp">MRP</label>
                                                                        <input step="any" min="0" class="form-control floatsaleprice" onblur="checkSalePrice()"
                                                                            oninput="limitDecimalPlaces(event, 2)" type="number" name="mrp" id="id_mrp" value="{{product_obj.mrp}}" required>
                                                                        
                                                                        
                                                                    </div>
                
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label w-100" for="id_sale_price">Sale Price (Sale Price will be inclusive of all taxes)</label>
                
                                                                        <input type="number"
                                                                                placeholder="0.00" step="any" min="0"
                                                                                class="form-control d-inline-block w-75 floatsaleprice" id="id_sale_price"
                                                                                onblur="checkSalePrice()"
                                                                                oninput="limitDecimalPlaces(event, 2); calculateTax();"
                                                                                name="sale_price" required />
                                                                                <!-- onchange="selectData()" -->
                                                                        <span class="d-inline-block font-underline" style="margin-top: 1px;display:block; font-size: 12px !important;">
                                                                            <a style="color:black;" href="" data-bs-toggle="modal" 
                                                                            data-bs-target="#showBreakdown" onclick="calcu()">How much do I get</a>
                                                                        </span>
                                                                        <div class="text-danger" style="display:none;" id="salePriceError">Sale price cannot be greater than product MRP</div>
                                                                    
                
                                                                        <input type="text" id="payment_gateway" name="payment_gateway"
                                                                                hidden />
                                                                        <input type="text" id="gstttt" name="gstttt" hidden />
                                                                        <input type="text" id="sale_pricee" name="final_pricee" hidden />
                                                                        <input type="text" id="commi" name="commi" hidden />
                                                                        <input type="text" id="prod_comm" name="prod_comm" hidden />
                                                                        <input type="text" id="seebreak" name="seebreak" hidden />
                                                                        <!-- <input type="text" id="defaultSP" name="defaultSP"  hidden /> -->
                
                                                                        <!-- ===========How much do i get============== -->
                                                                        <div class="modal fade" id="showBreakdown" tabindex="-1"
                                                                            role="dialog" aria-labelledby="exampleModalLabel"
                                                                            aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                    <div class="modal-header">
                                                                                        <h5 class="modal-title" id="exampleModalLabel">How
                                                                                            much do I get
                                                                                        </h5>
                                                                                        <button type="button" class="btn-close"
                                                                                            data-bs-dismiss="modal" aria-label="Close">
                                                                                        <span aria-hidden="true"></span>
                                                                                        </button>
                                                                                    </div>
                                                                                    <div class="modal-body">
                                                                                        <div class="form-row">
                                                                                            <div class="col-md-12"
                                                                                                style="margin-top: 10px;margin-bottom: 15px;">
                                                                                                <h6
                                                                                                    style="font-weight: 700;padding-left: 10px;">
                                                                                                    <i class="icon ion-pricetags"
                                                                                                        style="padding-right: 6px;font-size: 20px;"></i>Sale
                                                                                                    Price <i
                                                                                                        class="fa fa-rupee"></i>&nbsp;<input
                                                                                                        style="font-weight: 700;
                                                                                                        background-color: white;
                                                                                                        border: none;
                                                                                                        font-size: inherit;
                                                                                                        font-family: inherit;
                                                                                                        text-align: inherit;"
                                                                                                        id="inputValue1" readonly>
                                                                                                    <br>
                                                                                                </h6>
                                                                                                <div style="display: flex;height: 35px;
                                                                                                    align-items: baseline;">
                                                                                                    <h6
                                                                                                        style="font-weight: 700;padding-left: 10px;">
                                                                                                        <i class="icon ion-pricetags"
                                                                                                            style="padding-right: 6px;font-size: 20px;"></i>
                                                                                                    </h6>
                                                                                                    <h6 id="comm" style="font-weight: 700;">
                                                                                                        {{ans}}
                                                                                                    </h6>
                                                                                                    <h6 style="font-weight: 700;"
                                                                                                        id="percent">
                                                                                                        %
                                                                                                        Commission
                                                                                                        <li class="fa fa-rupee"></li>
                                                                                                        &nbsp;<input style="font-weight: 700;
                                                                                                            background-color: white;
                                                                                                            border: none;
                                                                                                            font-size: inherit;
                                                                                                            font-family: inherit;
                                                                                                            text-align: inherit;"
                                                                                                            id="commmision" name="commi"
                                                                                                            value="commmision"
                                                                                                            readonly>
                                                                                                    </h6>
                                                                                                </div>
                                                                                                <h6
                                                                                                    style="font-weight: 700;padding-left: 10px;">
                                                                                                    <i class="icon ion-pricetags"
                                                                                                        style="padding-right: 6px;font-size: 20px;"></i>
                                                                                                    1.8% Payment Gateway Charges <i
                                                                                                        class="fa fa-rupee"></i>&nbsp;<input
                                                                                                        style=" background-color: white;
                                                                                                        border: none;
                                                                                                        font-weight: 700;
                                                                                                        font-size: inherit;
                                                                                                        font-family: inherit;
                                                                                                        text-align: inherit;" id="pay"
                                                                                                        name="payment_gateway" value="pay"
                                                                                                        readonly><br>
                                                                                                </h6>
                                                                                                <h6
                                                                                                    style="font-weight: 700;padding-left: 10px">
                                                                                                    <i class="icon ion-pricetags"
                                                                                                        style="padding-right: 6px;font-size: 20px;"></i>18%
                                                                                                    GST <i
                                                                                                        class="fa fa-rupee"></i>&nbsp;<input
                                                                                                        style=" background-color: white;
                                                                                                        border: none;
                                                                                                        font-weight: 700;
                                                                                                        font-size: inherit;
                                                                                                        font-family: inherit;
                                                                                                        text-align: inherit;" id="ggst"
                                                                                                        name="gstttt" value="ggst"
                                                                                                        readonly><br>
                                                                                                </h6>
                                                                                                <h6 style="font-weight: 700;padding-left: 10px">
                                                                                                    <div>
                                                                                                        <i class="icon ion-pricetags"
                                                                                                            style="padding-right: 6px;font-size: 20px;"></i>You
                                                                                                        Receive <i
                                                                                                            class="fa fa-rupee"></i>&nbsp;<input
                                                                                                            id="result" name="net"
                                                                                                            readonly>
                                                                                                        <style>
                                                                                                            #result {
                                                                                                            background-color: white;
                                                                                                            font-weight: 700;
                                                                                                            border: none;
                                                                                                            font-size: inherit;
                                                                                                            font-family: inherit;
                                                                                                            text-align: inherit;
                                                                                                            }
                                                                                                        </style>
                                                                                                        <br>
                                                                                                        <p
                                                                                                            style="margin-top: 15px; margin-left:20px; font-size: 12px;">
                                                                                                            ( Shipping Excluded )
                                                                                                        </p>
                                                                                                        <p id='free'>
                                                                                                        </p>
                                                                                                    </div>
                                                                                                </h6>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div>
                                                                                </div>
                                                                            </div>
                                                                    </div>
                                                                    {% endif %}
                                                                
                
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label d-flex justify-content-between" for="id_tax_code">
                                                                            <span>Tax Code</span>
                                                                            
                                                                        </label>
                                                                        <select class="form-select" id="id_tax_code" title="Choose the GST Rate applicable to your product"
                                                                            name="tax_code" required onchange="calculateTax()">
                                                                            <option selected="true" disabled="disabled"></option>
                                                                            {% for tax_codes in tax_code %}
                                                                                <option value="{{ tax_codes.0 }}" {% if product_obj.product_has_variant == True %}{% if product_obj.product_variant.all %}{% for obj in product_obj.product_variant.all %}{% if obj.default_variant == True %}{% if obj.product_variant_price_structure %}{% if obj.product_variant_price_structure.tax_code == tax_codes.0 %}selected{% endif %}{% endif %}{% endif %}{% endfor %}{% endif %}{% endif %}>{{ tax_codes.1 }}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>

                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="form-label" for="id_shipping_include">Shipping Included</label>
                                                                        <select class="form-select" id="id_shipping_include" required name="shipping_include" title="Choose whether product delivery is included in the Sale Price.">
                                                                            <option disabled="true" selected value=""></option>
                                                                            <option value="True" {% if product_obj.shipping_include %} selected {% endif %}>Yes</option>
                                                                            <option value="False" {% if not product_obj.shipping_include %} selected {% endif %}>No</option>
                                                                        </select>
                                                                    
                                                                    </div>
                
                                                                    <div class="form-group col-md-7 mb-4">
                                                                        <label class="Minimum form-label" for="id_minimum_order_qunatity">Minimum Order Quantity</label>
                                                                        <div class="row">
                                                                            <div class="col-md-3">
                                                                                <input class="Minimum2 form-control" id="id_minimum_order_qunatity" value="{{product_obj.minimum_order_qunatity|default_if_none:''}}" type="text" name="minimum_order_qunatity" step="0.01" required>
                                                                            
                                                                            </div>
                                                                            <div class=" col-md-3 Minimum5 ">
                                                                                <select class="Minimum3 form-select" style="" name="minimum_order_qunatity_unit" id="id_minimum_order_qunatity_unit" required>
                                                                                    <option value="" disabled selected > </option>
                                                                                    {% for minimum_quantity in minimum_order_quantity %}
                                                                                        <option value="{{ minimum_quantity.0 }}" {% if product_obj.minimum_order_qunatity_unit ==  minimum_quantity.0 %}selected{% endif %} >{{ minimum_quantity.1 }}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            
                                                                            </div>
                                                                        </div>
                                                                        
                                                                    </div>
                                                                </div>
                                                                <button class="btn btn-dark mt-3" onclick="stepperForm.previous()">PREV</button>

                                                                <button class="btn btn-brand mt-3 btn-next-form">Next</button>
                                                            </form>
                                                        {% endif %}
                                                    </div>
                                                    
                                                    <div id="stepper-form-5"  role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="stepperFormTrigger5">
                                                        step 5
                                                    </div>



                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock content %}
{% block jsblock %}
    <script rel="stylesheet" href="{% static 'seventh-square/assets/js/bs-stepper/bs-stepper.min.js' %}"></script>  

    <script>
					
		$(document).ready(function () {
			var token = $("input[name=csrfmiddlewaretoken]").val();
	
			$("#basic-info-form").validate({
                rules: {
                    hsn_code: {
                        required: true
                    },
                    price_on_request: {
                        required: true
                    },
                    mrp: {
                        required: true
                    },
                    sale_price: {
                        required: true 
                    },
                    shipping_include: {
                        required: true 
                    },
                    minimum_order_qunatity: {
                        required: true 
                    },
                    minimum_order_qunatity_unit: {
                        required: true 
                    },

                },
                messages: {
                    hsn_code: {
                        required: "This field is required."
                    },
                    price_on_request: {
                        required: "This field is required."
                    },
                    mrp: {
                        required: "This field is required."
                    },
                    sale_price: {
                        required: "This field is required."
                    },
                    shipping_include: {
                        required: "This field is required."
                    },
                    minimum_order_qunatity: {
                        required: "This field is required."
                    },
                    minimum_order_qunatity_unit: {
                        required: "This field is required."
                    },
                }
            });
		});

		{% comment %} except-user-phone-number-check/ {% endcomment %}
	</script>

    <script>
        function checkReturn() {
            var returnable_p = (document.getElementById("returnable").value);
        }
    </script>
    
    <script>
        function validateHSN(input) {
            // Get the entered value as a string
            let value = input.value.toString();
        
            // Remove any non-digit characters (except the first digit if it's a minus sign for negative numbers)
            value = value.replace(/[^\d-]|(?<=\d)-/g, '');
        
            // Limit the length to 8 digits
            if (value.length > 8) {
                value = value.substr(0, 8);
            }
        
            // Update the input value
            input.value = value;
        
            // Check if the value contains exactly 8 digits
            if (/^\d{1,8}$/.test(value)) {
                input.setCustomValidity('');
                input.classList.remove('is-invalid');
            } else {
                input.setCustomValidity('Invalid HSN. Must be exactly 8 digits long.');
                input.classList.add('is-invalid');
            }
        }
    </script>

    <script>
        // Get the input element
        const qtyInput = document.getElementById('secondP');
      
        // Add an event listener for keyup
        qtyInput.addEventListener('keyup', function () {
          // Remove any non-numeric characters (including decimals)
          const inputValue = qtyInput.value.replace(/[^0-9]/g, '');
      
          // Update the input field with the cleaned value
          qtyInput.value = inputValue;
        });
    </script>

    <script>
        function checkPOQ() {
            var poqDropdown = document.getElementById('id_price_on_request');
            var markedPriceInput = document.getElementById('id_mrp');
            var sellingPriceInput = document.getElementById('id_sale_price');
            var gstRateInput = document.getElementById('id_tax_code');
            //var taxableAmountInput = document.getElementById('taxAmount');
            var shipCheckInput = document.getElementById('id_shipping_include');
        
            if (poqDropdown.value === 'True') {
                // If POQ is true, disable and clear the fields
                markedPriceInput.removeAttribute('required');
                markedPriceInput.setAttribute('disabled', 'true');
                markedPriceInput.value = null;
                markedPriceInput.classList.add('readonly-only-highlight');
        
                sellingPriceInput.removeAttribute('required');
                sellingPriceInput.setAttribute('disabled', 'true');
                sellingPriceInput.value = null;
                sellingPriceInput.classList.add('readonly-only-highlight');
        
                gstRateInput.setAttribute('disabled', 'true');
                gstRateInput.value = null;
                gstRateInput.classList.add('readonly-only-highlight');
        
                //taxableAmountInput.setAttribute('readonly', 'true');
                //taxableAmountInput.value = null;
        
                shipCheckInput.setAttribute('disabled', 'true');
                shipCheckInput.value = '';
                shipCheckInput.classList.add('readonly-only-highlight');
            } else {
                // If POQ is false, enable and make the fields required
                markedPriceInput.removeAttribute('disabled');
                markedPriceInput.setAttribute('required', 'true');
                markedPriceInput.classList.remove('readonly-only-highlight');
        
                sellingPriceInput.removeAttribute('disabled');
                sellingPriceInput.setAttribute('required', 'true');
                sellingPriceInput.classList.remove('readonly-only-highlight');
        
                gstRateInput.removeAttribute('disabled');
                gstRateInput.classList.remove('readonly-only-highlight');
        
                //taxableAmountInput.removeAttribute('readonly');
        
                shipCheckInput.removeAttribute('disabled');
                shipCheckInput.classList.remove('readonly-only-highlight');
            }
        }
        
    </script>

    <script>
        function calcuvar() {
        // $('#seebreak').val(1);
            var sale_price = parseFloat($('#defaultSP').val());
        
        
        
            var taxper = parseInt(document.getElementById("sel1").value);
        
            if (document.getElementById("gst_check").value == "False") {
                console.log("tax changes")
                console.log(taxper)
                taxable_amount = ((taxper / 100) * sale_price).toFixed(2);
                console.log(("sale_price+taxable_amount"))
                console.log((parseFloat(sale_price) + parseFloat(taxable_amount)))
        
                if ((parseFloat(sale_price) + parseFloat(taxable_amount)) > parseFloat(mrp_price)) {
                    alert("Sale price can’t be greater than MRP ")
                }
        
                sale_price = sale_price + ((sale_price * taxper) / 100)
                console.log("now sale_price")
            }
            var av = document.getElementById("comm").innerText;
            console.log("av")
            console.log(av)
        
            console.log("av 980")
            console.log(av)
        
            var gstt = parseFloat(av);
            console.log("gstt")
            console.log(gstt)
        
            if (av == " ₹3") {
        //   var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "3 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(3);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add line 1007")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(3) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val("3 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve3').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("3/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
        
            } else if (av == "111") {
        
        // var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "2 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(2);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(2) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val("2 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("2/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
            } else {
                console.log("last part")
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "block";
                var showCommission = ((gstt / 100) * sale_price).toFixed(2);
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(showCommission);
                console.log(showCommission)
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(showCommission) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val(showCommission);
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve3').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val(showCommission);
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
        
            }
        }
        function calcu() {
            var inputValue1 = parseFloat(document.getElementById("sale_price").value);
            var av = document.getElementById("comm").innerText;
            var commi = Number(av);
        
            var ccomm;
            if (commi === 3) {
                ccomm = 3; // Use commi directly as commission percentage
                var taxtotal = ccomm + 0.198;
        
                let commmision = 3    ;
                let pay = (inputValue1 * .018).toFixed(2);
        
                let ggsstt = Number(commmision) + Number(pay);
                let ggst = (ggsstt * .18).toFixed(2);
                let total = (Number(ggst) + Number(pay) + Number(commmision));
                let result = (inputValue1 - total).toFixed(2);
        
                document.getElementById("result").value = result;
                document.getElementById("commmision").value = commmision;
                document.getElementById("pay").value = pay;
                document.getElementById("ggst").value = ggst;
                document.getElementById("inputValue1").value = inputValue1.toFixed(2);
        
            } else {
                ccomm = commi / 100;
                var taxtotal = ccomm + 0.198;
        
                let commmision = (ccomm * inputValue1).toFixed(2);
                let pay = (inputValue1 * .018).toFixed(2);
        
                let ggsstt = Number(commmision) + Number(pay);
                let ggst = (ggsstt * .18).toFixed(2);
                let total = (Number(ggst) + Number(pay) + Number(commmision));
                let result = (inputValue1 - total).toFixed(2);
        
                document.getElementById("result").value = result;
                document.getElementById("commmision").value = commmision;
                document.getElementById("pay").value = pay;
                document.getElementById("ggst").value = ggst;
                document.getElementById("inputValue1").value = inputValue1.toFixed(2);
        
            }
        
        
        
        
        } {
        
            $('#seebreak').val(1);
            var sale_price = parseFloat($('#sale_price').val());
        
        
        
            var taxper = parseInt(document.getElementById("sel1").value);
        
            if (document.getElementById("gst_check").value == "False") {
                console.log("tax changes")
                console.log(taxper)
                taxable_amount = ((taxper / 100) * sale_price).toFixed(2);
                console.log(("sale_price+taxable_amount"))
                console.log((parseFloat(sale_price) + parseFloat(taxable_amount)))
        
                if ((parseFloat(sale_price) + parseFloat(taxable_amount)) > parseFloat(mrp_price)) {
                    alert("Sale price can’t be greater than MRP")
                }
        
                sale_price = sale_price + ((sale_price * taxper) / 100)
                console.log("now sale_price")
            }
            var av = document.getElementById("comm").innerText;
            console.log("av")
            console.log("4444444444444444444444", av)
        
            console.log("av 980")
            console.log(av)
        
            var gstt = parseFloat(av);
            console.log("gstt")
            console.log(gstt)
        
            if (av == " ₹3") {
        //   var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "3 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(3);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add line 1007")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(3) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val("3 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("3/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
        
            } else if (av == "111") {
        
        // var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "2 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(2);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(2) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val("2 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("2/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
            } else {
                console.log("last part")
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "block";
                var showCommission = ((gstt / 100) * sale_price).toFixed(2);
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(showCommission);
                console.log(showCommission)
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(showCommission) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);
        
                $('#showCommission').val(showCommission);
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val(showCommission);
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);
        
        
            }
        }
        function showBreakdown() {
            var sale_price = parseFloat($('#sale_price').val());
            var av = document.getElementById("comm").innerText;
            var gstt = parseFloat(av);
            var showCommission = ((gstt / 100) * sale_price).toFixed(3);
            var showPayment = ((18 / 1000) * sale_price).toFixed(3);
            var add = parseFloat(showPayment) + parseFloat(showCommission);
            var showGst = ((18 / 100) * add).toFixed(3);
            var added = parseFloat(showCommission) + parseFloat(showPayment) + parseFloat(showGst);
            var showRecieve = (sale_price - added).toFixed(3);
        
            $('#showSale').val(sale_price);
            $('#showCommission').val(showCommission);
            $('#showPayment').val(showPayment);
            $('#showGst').val(showGst);
            $('#showRecieve2').val(showRecieve);
        }
    </script>

    <script>
        function checkReturn() {
            var returnable_p = (document.getElementById("returnable").value);
        }
    </script>
    <script>
        function checkReturn() {
            var returnable_p = (document.getElementById("returnable").value);
        }
    </script>

    <script>
        function calculateTax() {
            var gstRate = document.getElementById("gstRate").value;
            var salePrice = document.getElementById("sale_price").value;
            var tt = (gstRate / 100)
            var tax = salePrice / (1 + tt);
            var taxAmount = salePrice - tax;
            document.getElementById("taxAmount").value = taxAmount.toFixed(2);
        }
    </script>

    <script>
        function taxCalc(ele) {
            if (document.getElementById("gst_check").value == "True") {
                var tax_included = true;
                var sale_price = parseFloat($('#sale_price').val());
                $('#sale_pricee').val(sale_price);

                if (!sale_price) {
                    console.log("yes no sale price")
                    sale_price = parseFloat($('#defpro_sp').val());
                    $('#sale_pricee').val(sale_price);
                    console.log(sale_price)

                }
                var mrp_price = parseFloat($('#productMRP').val());
                if (!mrp_price) {
                    console.log("yes no MRP")
                    mrp_price = parseFloat($('#defpro_mp').val());
                    console.log(mrp_price)

                }
                var values = parseInt(document.getElementById("sel1").value);
                var percentage;
                var taxable_amount;
                switch (values) {
                    case 0:

                        percentage = 0;

                        break;

                    case 5:
                        percentage = 5;

                        break;

                    case 12:
                        percentage = 12;

                        break;
                    case 18:
                        percentage = 18;

                        break;
                    case 28:
                        percentage = 28;


                        break;

                    default:
                        alert("The default case is true!");
                        break;
                }
                if (sale_price <= mrp_price) {
                    if (isNaN(sale_price) || isNaN(percentage)) {
                        taxable_amount = " ";
                    } else {
                        taxable_amount = (sale_price - (sale_price / (1 + (percentage / 100)))).toFixed(2);

                    }
                    $('#secondP').val(taxable_amount);
                }
                else {
                    alert("Sale Price can't be greater than MRP")
                }

            }
            else {
                var tax_included = false;
                var sale_price = parseFloat($('#sale_price').val());
                $('#sale_pricee').val(sale_price);

                if (!sale_price) {
                    console.log("yes no sale price")
                    sale_price = parseFloat($('#defpro_sp').val());
                    $('#sale_pricee').val(sale_price);


                }
                var mrp_price = parseFloat($('#productMRP').val());
                if (!mrp_price) {
                    console.log("yes no sale price")
                    mrp_price = parseFloat($('#defpro_mp').val());

                }
                var values = parseInt(document.getElementById("sel1").value);
                var percentage;
                var taxable_amount;
                switch (values) {
                    case 0:

                        percentage = 0;

                        break;

                    case 5:
                        percentage = 5;

                        break;

                    case 12:
                        percentage = 12;

                        break;
                    case 18:
                        percentage = 18;

                        break;
                    case 28:
                        percentage = 28;


                        break;

                    default:
                        alert("The default case is true!");
                        break;
                }
                console.log("tax false is running")
                taxable_amount = ((percentage / 100) * sale_price).toFixed(2);
                console.log(("sale_price+taxable_amount 1"))
                console.log((parseFloat(sale_price) + parseFloat(taxable_amount)))
                console.log("mrp_price")
                console.log((parseFloat(mrp_price)))


                if ((parseFloat(sale_price) + parseFloat(taxable_amount)) > parseFloat(mrp_price)) {
                    alert("Sale price can’t be greater than MRP")
                    // alert("Sale price can’t be greater than MRP tax add 7")
                } else {
                    $('#sale_pricee').val(parseFloat(sale_price) + parseFloat(taxable_amount));

                }

                if (sale_price <= mrp_price) {
                    if (isNaN(sale_price) || isNaN(percentage)) {
                        taxable_amount = " ";
                    }
                    $('#secondP').val(taxable_amount);
                    $('#sale_pricee').val(parseFloat(sale_price) + parseFloat(taxable_amount));

                }
                else {
                    alert("Sale Price can't be greater than MRP")
                }
            }
        }
        function selectData() {

            $('#seebreak').val(1);
            var sale_price = parseFloat($('#sale_price').val());
            if (!sale_price) {
                console.log("yes no sale price")
                sale_price = parseFloat($('#defpro_sp').val());

            }



            var taxper = parseInt(document.getElementById("sel1").value);

            if (document.getElementById("gst_check").value == "False") {
                console.log("tax changes")
                console.log(taxper)
                taxable_amount = ((taxper / 100) * sale_price).toFixed(2);
                console.log(("sale_price+taxable_amount"))
                console.log((parseFloat(sale_price) + parseFloat(taxable_amount)))

                if ((parseFloat(sale_price) + parseFloat(taxable_amount)) > parseFloat(mrp_price)) {
                    alert("Sale price can’t be greater than MRP")
                }

                sale_price = sale_price + ((sale_price * taxper) / 100)
                console.log("now sale_price")
                $('#sale_pricee').val(sale_price);
            }
            var av = document.getElementById("comm").innerText;
            console.log("av")
            console.log(av)

            console.log("av 980")
            console.log(av)

            var gstt = parseFloat(av);
            console.log("gstt")
            console.log(gstt)

            if (av == " ₹3") {
                //   var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "3 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(3);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add line 1007")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(3) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);

                $('#showCommission').val("3 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                console.log("showRecieve2", showRecieve)
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("3/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);


            } else if (av == "111") {

                // var sale_price = parseFloat($('#sale_price').val());
                var showCommission = "2 / bag"
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "none";
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(2);
                console.log(showCommission)
                console.log("showPayment")
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(2) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);

                $('#showCommission').val("2 / bag");
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                console.log("showRecieve2", showRecieve)

                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val("2/bag");
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);

            } else {
                console.log("last part")
                var showDiv = document.getElementById("percent");
                showDiv.style.display = "block";
                var showCommission = ((gstt / 100) * sale_price).toFixed(2);
                var showPayment = ((18 / 1000) * sale_price).toFixed(2);
                var add = parseFloat(showPayment) + parseFloat(showCommission);
                console.log(showCommission)
                console.log(showPayment)
                console.log("add")
                console.log(add)
                var showGst = ((0.18) * parseFloat(add)).toFixed(2);
                var added = parseFloat(showCommission) + parseFloat(showPayment) + parseFloat(showGst);
                var showRecieve = (sale_price - added).toFixed(2);
                $('#showSale').val(sale_price);
                $('#sale_pricee').val(sale_price);

                $('#showCommission').val(showCommission);
                $('#showPayment').val(showPayment);
                $('#showGst').val(showGst);
                $('#showRecieve2').val(showRecieve);
                $('#gstttt').val(showGst);
                $('#commi').val(showCommission);
                $('#payment_gateway').val(showPayment);
                $('#prod_comm').val(av);


            }
            if (document.getElementById("gst_check").value == "True") {
                var sale_price = parseFloat($('#sale_price').val());
                if (!sale_price) {
                    console.log("yes no sale price")
                    sale_price = parseFloat($('#defpro_sp').val());

                }
                var mrp_price = parseFloat($('#productMRP').val());
                if (!mrp_price) {
                    console.log("yes no sale price")
                    mrp_price = parseFloat($('#defpro_mp').val());

                }
                var values = parseInt(document.getElementById("sel1").value);
                var percentage;
                var taxable_amount;
                switch (values) {
                    case 0:

                        percentage = 0;

                        break;

                    case 5:
                        percentage = 5;

                        break;

                    case 12:
                        percentage = 12;

                        break;
                    case 18:
                        percentage = 18;

                        break;
                    case 28:
                        percentage = 28;


                        break;

                    default:
                        alert("The default case is true!");
                        break;
                }
                console.log("sale_price")
                console.log(sale_price)
                console.log("mrp_price")
                console.log(mrp_price)
                if (sale_price <= mrp_price) {
                    if (isNaN(sale_price) || isNaN(percentage)) {
                        taxable_amount = " ";
                    } else {
                        taxable_amount = (sale_price - (sale_price / (1 + (percentage / 100)))).toFixed(2);
                    }
                    $('#secondP').val(taxable_amount);
                }
                else {
                    alert("Sale Price can't be greater than MRP")
                }

            } else {
                var sale_price = parseFloat($('#sale_price').val());
                if (!sale_price) {
                    console.log("yes no sale price")
                    sale_price = parseFloat($('#defpro_sp').val());
                    console.log("sale_price", sale_price)
                }
                var mrp_price = parseFloat($('#productMRP').val());
                if (!mrp_price) {
                    console.log("yes no MRP")
                    mrp_price = parseFloat($('#defpro_mp').val());
                    console.log(mrp_price)

                }

                var values = parseInt(document.getElementById("sel1").value);
                var percentage;
                var taxable_amount;
                switch (values) {
                    case 0:

                        percentage = 0;

                        break;

                    case 5:
                        percentage = 5;

                        break;

                    case 12:
                        percentage = 12;

                        break;
                    case 18:
                        percentage = 18;

                        break;
                    case 28:
                        percentage = 28;
                        break;

                    default:
                        alert("The default case is true!");
                        break;
                }
                if (sale_price <= mrp_price) {
                    if (isNaN(sale_price) || isNaN(percentage)) {
                        taxable_amount = " ";
                    } else {
                        taxable_amount = ((percentage / 100) * sale_price).toFixed(3);
                        // taxable_amount = ((taxper / 100) * sale_price).toFixed(2);
                        console.log(("sale_price+taxable_amount"))
                        console.log((parseFloat(sale_price) + parseFloat(taxable_amount)))

                        if ((parseFloat(sale_price) + parseFloat(taxable_amount)) > parseFloat(mrp_price)) {
                            alert("Sale price can’t be greater than MRP ")
                        }


                    }
                    $('#secondP').val(taxable_amount);
                }
                else {
                    alert("Sale Price can't be greater than MRP tab 2")
                }


            }
        }

    </script>
    <script>
        function checkSalePrice() {
            var poqDropdown = document.getElementById('id_price_on_request');
            if (poqDropdown.value === 'False' || poqDropdown.value === '' ) {
                var productMRPInput = document.getElementById('id_mrp');
                var salePriceInput = document.getElementById('id_sale_price');
                var productMRP = parseFloat(productMRPInput.value);
                var salePrice = parseFloat(salePriceInput.value);
                var salePriceError = document.getElementById('salePriceError');
                if (salePrice > productMRP) {
                    // Sale price is greater than product MRP
                    salePriceError.style.display = 'block';
                    salePriceInput.focus(); // Focus on the sale price input
                }else{
                    salePriceError.style.display = 'none';
                }
            }else{
                // If poqDropdown is not 'True', do nothing
                return;

            }
          }
    </script>
    <script>
        function limitDecimalPlaces(e, count) {
            if (e.target.value.indexOf('.') == -1) { return; }
            if ((e.target.value.length - e.target.value.indexOf('.')) > count) {
                e.target.value = parseFloat(e.target.value).toFixed(count);
            }
        }
    </script>

{% endblock jsblock %}